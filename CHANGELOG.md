## [v4.2] - 2026-01-23

### ✨ 新增功能 (New Features)
- **外部配置化 (External Config)**: 支持通过项目根目录下的 `config.json` 灵活配置 `Cookie`、`User-Agent` 及请求参数（超时、休眠间隔等），有效应对微信反爬策略升级及权限访问限制。
- **安全隔离**: 自动忽略 `config.json` 的版本追踪，并在项目中提供 `config.sample.json` 作为配置模板，确保用户隐私数据不被泄露。
- **特殊页面解析 (Fail-Safe Parsing)**: 针对微信“图片频道” (`image_detail`) 等非标准结构文章，引入了备用解析策略。当标准解析失败时，自动尝试从 JS 数据中提取图片内容，无需人工干预。
- **智能反爬检测**: 在下载阶段自动识别微信的“访问验证”或“系统繁忙”页面，并给出明确的配置提示，避免误报为解析错误。

### 🚀 功能提升 (Improvements)
- **下载器健壮性**: 引入全局配置深度合并逻辑，在无外部配置时自动回退至内置默认安全设置。

---

## [v4.1] - 2026-01-23

### ✨ 新增功能 (New Features)
- **元数据生成 (Metadata)**: 每篇文章的目录下自动生成 `metadata.json`，包含标题、作者、发布日期、原文链接及下载时间等关键信息，便于第三方工具集成。
- **全局索引 (Global Index)**: 在输出根目录下自动生成 `index.html`（现代化 UI），按时间倒序列出所有已下载文章，支持一键本地阅读和跳转原文。
- **内容清洗 (Clean Content)**: 深度清洗 HTML 内容，自动移除底部的二维码、广告栏、点赞/在看工具条和赞赏区域，显著提升 Markdown 和 PDF 的阅读纯净度。

### 🚀 功能提升 (Improvements)
- **UI 升级**: 全局索引页面采用 Material Design 风格，响应式布局，阅读体验更佳。
- **流程优化**: 即使没有新任务，程序现在也会自动扫描输出目录并重建索引文件，方便管理已有资产。

---

## [v4.0] - 2026-01-22

### ✨ 新增功能 (New Features)
- **默认 HTML 输出**: 程序现在默认生成包含完整样式和本地化资源的独立 HTML 文件。
- **可选输出格式**: Markdown 和 PDF 格式的生成现在通过 `--markdown` 和 `--pdf` 命令行参数进行控制，默认不激活。
- **智能文件名截断**: 优化了文件名处理逻辑，确保文章标题在作为文件名时不会因过长而导致系统错误，文件名长度严格限制在100个字符以内。
- **PDF 容错机制**: 增强 PDF 生成的健壮性，当检测到 wkhtmltopdf 环境不支持高级功能（如目录和页码）时，能自动退化为生成普通 PDF，避免程序中断。

### 🚀 功能提升 (Improvements)
- **渲染逻辑重构**: 深度优化 Markdown 转换逻辑，优先采用标准 HTML 解析以完整保留文章的正文、标题层级和图片排版，有效解决了“图文文章”被误判为“相册页面”导致的正文丢失问题。
- **发布日期自动提取**: 新增从文章 HTML 源码中自动提取 `publish_time` 或 `window.ct` 的功能，使下载的文章带有真实的原始发布日期。
- **智能数据清洗**: 增加了对原始聊天记录 (`messages.txt`) 的提取支持，可自动从混乱的文本中精准识别并去重微信文章 URL。

### 📂 目录结构优化 (Organization)
- **扁平化管理**: 输出文件夹结构由嵌套模式优化为扁平模式：`output/{文章标题}_{发布日期}/`。
- **文件对齐**: 确保 Markdown、PDF 及图片素材 (`assets/`) 均在同一级目录下，大幅提升了在 Obsidian、Zotero 等工具中的引用体验。

### 🔧 稳定性修复 (Bug Fixes)
- **正则表达式修复**: 修复了日期提取逻辑中的正则语法错误。
- **路径与命名**: 增强了对非法字符的过滤 (sanitize)，防止因特殊标题导致的目录创建失败。
- **适配器兼容性**: 解决了在某些 Python 环境下请求 URL 时可能触发的 "No connection adapters" 报错。

---

## [v3.4] - 2026-01-22
- **渲染逻辑重构**: 深度优化 Markdown 转换逻辑，优先采用标准 HTML 解析以完整保留文章的正文、标题层级和图片排版，有效解决了“图文文章”被误判为“相册页面”导致的正文丢失问题。
- **发布日期自动提取**: 新增从文章 HTML 源码中自动提取 `publish_time` 或 `window.ct` 的功能，使下载的文章带有真实的原始发布日期。
- **智能数据清洗**: 增加了对原始聊天记录 (`messages.txt`) 的提取支持，可自动从混乱的文本中精准识别并去重微信文章 URL。

### 📂 目录结构优化 (Organization)
- **扁平化管理**: 输出文件夹结构由嵌套模式优化为扁平模式：`output/{文章标题}_{发布日期}/`。
- **文件对齐**: 确保 Markdown、PDF 及图片素材 (`assets/`) 均在同一级目录下，大幅提升了在 Obsidian、Zotero 等工具中的引用体验。

### 🔧 稳定性修复 (Bug Fixes)
- **正则表达式修复**: 修复了日期提取逻辑中的正则语法错误。
- **路径与命名**: 增强了对非法字符的过滤 (sanitize)，防止因特殊标题导致的目录创建失败。
- **适配器兼容性**: 解决了在某些 Python 环境下请求 URL 时可能触发的 "No connection adapters" 报错。

---

## [v3.3] - 2026-01-15
- 支持断点续传功能 (history.log)。
- 引入基础 PDF 生成转换。
- 增加数据库解密模块初步逻辑。
